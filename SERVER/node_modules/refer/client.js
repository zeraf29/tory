/*
 * client.js
 */

// module
var net = require('net');

// vars
var port = 8887;
var conn = null;

var retryInterval = 3000;
var retriedTimes = 0;
var maxRetries = 10;

process.stdin.resume();

(function connect() {
    function reconnect() {
        if (retriedTimes >= maxRetries) {
            throw new Error('Server is not responsing...');
        }
        retriedTimes++;
        setTimeout(connect, retryInterval);
    }

    conn = net.createConnection(port);

    conn.on('connect', function() {
        console.log('Hi. This is server for connecting web and darwin-op');
        retriedTimes = 0;
    });

    conn.on('data', function(data) {
        console.log('From server:', data.toString());
    });

    conn.on('error', function(err) {
        console.log('err:' + err.message);
    });

    conn.on('close', function() {
        console.log('Close connection');
    });

    process.stdin.pipe(conn, {end: false});

}());
